{% extends 'base.html' %}
{% load embed_video_tags static %}

{% block title %}{{ vlog.title }} - VlogSite{% endblock %}

{% block content %}
  <div class="row g-4">
    <aside class="col-lg-4 order-2 order-lg-1">
      <div class="about-card p-3 rounded-3 mb-3">
        <h2 class="h6 mb-3">İlgili Vloglar</h2>
        {% for r in related_vlogs %}
          <a href="{% url 'vlogs:detail' r.slug %}" class="d-flex gap-3 align-items-center mb-3 text-decoration-none">
            <div class="ratio ratio-16x9" style="width: 120px;">
              {% if r.thumbnail %}
                <img src="{{ r.thumbnail.url }}" class="rounded object-fit-cover" alt="{{ r.title }}">
              {% endif %}
            </div>
            <div class="flex-grow-1 small text-white-50">{{ r.title }}</div>
          </a>
        {% empty %}
          <div class="text-white-50 small">Benzer içerik bulunamadı.</div>
        {% endfor %}
      </div>
    </aside>

    <article class="col-lg-8 order-1 order-lg-2">
      <header class="mb-3">
        <h1 class="h3">{{ vlog.title }}</h1>
        <div class="text-white-50 small">{{ vlog.author.get_full_name|default:vlog.author.username }} • {{ vlog.created_at|date:'d.m.Y H:i' }}</div>
      </header>

      <div class="ratio ratio-16x9 mb-3">
        {% video vlog.video_url '100% x 100%' %}
      </div>

      <p class="lead text-white-50">{{ vlog.description|linebreaks }}</p>

      <section class="mt-5">
        <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
          <h2 class="h6 m-0">Yorumlar</h2>
          <span class="badge text-bg-dark border">{{ comments|length }} yorum</span>
        </div>

        <div class="vstack gap-3 mb-4">
          {% for c in comments %}
            <div class="comment-item p-3 rounded-3">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <strong>{{ c.name }}</strong>
                <small class="text-white-50">{{ c.created_at|date:'d.m.Y H:i' }}</small>
              </div>
              <div class="text-white-80">{{ c.content|linebreaks }}</div>
            </div>
          {% empty %}
            <div class="text-white-50">Henüz yorum yok. İlk yorumu siz yazın.</div>
          {% endfor %}
        </div>

        <form class="comment-form p-3 rounded-3" method="post">
          {% csrf_token %}
          <div class="row g-2 align-items-start">
            <div class="col-md-3">
              <input required name="name" class="form-control form-control-lg bg-dark border-secondary text-light" placeholder="Adınız">
            </div>
            <div class="col-md-7">
              <textarea required name="content" class="form-control form-control-lg bg-dark border-secondary text-light" rows="1" placeholder="Yorumunuzu yazın..."></textarea>
            </div>
            <div class="col-md-2 d-grid">
              <button class="btn btn-primary btn-lg">Gönder</button>
            </div>
          </div>
        </form>
      </section>
    </article>
  </div>
{% endblock %}


